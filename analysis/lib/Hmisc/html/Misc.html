<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><title>R: Miscellaneous Functions</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link rel="stylesheet" type="text/css" href="R.css" />
</head><body><div class="container">

<table width="100%" summary="page for Misc {Hmisc}"><tr><td>Misc {Hmisc}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Miscellaneous Functions</h2>

<h3>Description</h3>

<p>This documents miscellaneous small functions in Hmisc that may be of
interest to users.
</p>
<p><code>clowess</code> runs <code>lowess</code> but if the <code>iter</code> argument
exceeds zero, sometimes wild values can result, in which case
<code>lowess</code> is re-run with <code>iter=0</code>.
</p>
<p><code>confbar</code> draws multi-level confidence bars using small rectangles
that may be of different colors.
</p>
<p><code>getLatestSource</code> fetches and <code>source</code>s the most recent
source code for functions in GitHub.
</p>
<p><code>grType</code> retrieves the system option <code>grType</code>, which is
forced to be <code>"base"</code> if the <code>plotly</code> package is not
installed.
</p>
<p><code>prType</code> retrieves the system option <code>prType</code>, which is
set to <code>"plain"</code> if the option is not set.  <code>print</code> methods
that allow for markdown/html/latex can be automatically invoked by
setting <code>options(prType="html")</code> or
<code>options(prType='latex')</code>.
</p>
<p><code>htmlSpecialType</code> retrieves the system option
<code>htmlSpecialType</code>, which is set to <code>"unicode"</code> if the option
is not set.  <code>htmlSpecialType='unicode'</code> cause html-generating
functions in <code>Hmisc</code> and <code>rms</code> to use unicode for special
characters, and <code>htmlSpecialType='&amp;'</code> uses the older ampersand
3-digit format. 
</p>
<p><code>inverseFunction</code> generates a function to find all inverses of a
monotonic or nonmonotonic function that is tabulated at vectors (x,y),
typically 1000 points.  If the original function is monotonic, simple linear
interpolation is used and the result is a vector, otherwise linear
interpolation is used within each interval in which the function is
monotonic and the result is a matrix with number of columns equal to the
number of monotonic intervals.  If a requested y is not within any
interval, the extreme x that pertains to the nearest extreme y is
returned. Specifying what='sample' to the returned function will cause a
vector to be returned instead of a matrix, with elements taken as a
random choice of the possible inverses.
</p>
<p><code>james.stein</code> computes James-Stein shrunken estimates of cell
means given a response variable (which may be binary) and a grouping
indicator.
</p>
<p><code>keepHattrib</code> for an input variable or a data frame, creates a
list object saving special Hmisc attributes such as <code>label</code> and
<code>units</code> that might be lost during certain operations such as
running <code>data.table</code>.  <code>restoreHattrib</code> restores these attributes.
</p>
<p><code>km.quick</code> provides a fast way to invoke <code>survfitKM</code> in the
<code>survival</code> package to get Kaplan-Meier estimates for a
single stratum for a vector of time points (if <code>times</code> is given) or to
get a vector of survival time quantiles (if <code>q</code> is given).
</p>
<p><code>latexBuild</code> takes pairs of character strings and produces a
single character string containing concatenation of all of them, plus
an attribute <code>"close"</code> which is a character string containing the
LaTeX closure that will balance LaTeX code with respect to
parentheses, braces, brackets, or <code>begin</code> vs. <code>end</code>.  When
an even-numbered element of the vector is not a left parenthesis,
brace, or bracket, the element is taken as a word that was surrounded
by <code>begin</code> and braces, for which the corresponding <code>end</code> is
constructed in the returned attribute.
</p>
<p><code>lm.fit.qr.bare</code> is a fast stripped-down function for computing
regression coefficients, residuals, <i>R^2</i>, and fitted values.  It
uses <code>lm.fit</code>. 
</p>
<p><code>matxv</code> multiplies a matrix by a vector, handling automatic
addition of intercepts if the matrix does not have a column of ones.
If the first argument is not a matrix, it will be converted to one.
An optional argument allows the second argument to be treated as a
matrix, useful when its rows represent bootstrap reps of
coefficients.  Then ab' is computed.  <code>matxv</code> respects the
<code>"intercepts"</code> attribute if it is stored on <code>b</code> by the
<code>rms</code> package.  This is used by <code><a href="../../rms/help/orm.html">orm</a></code>
fits that are bootstrap-repeated by <code><a href="../../rms/help/bootcov.html">bootcov</a></code> where
only the intercept corresponding to the median is retained.  If
<code>kint</code> has nonzero length, it is checked for consistency with the
attribute.
</p>
<p><code>makeSteps</code> is a copy of the dostep function inside the
<code>survival</code> package's <code>plot.survfit</code> function.  It expands a
series of points to include all the segments needed to plot step
functions.  This is useful for drawing polygons to shade confidence
bands for step functions.
</p>
<p><code>nomiss</code> returns a data frame (if its argument is one) with rows
corresponding to <code>NA</code>s removed, or it returns a matrix with rows
with any element missing removed.
</p>
<p><code>outerText</code> uses <code>axis()</code> to put right-justified text
strings in the right margin.  Placement depends on
<code>par('mar')[4]</code>
</p>
<p><code>plotlyParm</code> is a list of functions useful for specifying
parameters to <code>plotly</code> graphics.
</p>
<p><code>plotp</code> is a generic to handle <code>plotp</code> methods to make
<code>plotly</code> graphics.
</p>
<p><code>rendHTML</code> renders HTML in a character vector, first converting
to one character string with newline delimeters.  If <code>knitr</code> is
currently running, runs this string through <code>knitr::asis_output</code>
so that the user need not include <code>results='asis'</code> in the chunk
header for R Markdown or Quarto.  If <code>knitr</code> is not running, uses
<code>htmltools::browsable</code> and <code>htmltools::HTML</code> and prints the
result so that an RStudio viewer (if running inside RStudio) or
separate browser window displays the rendered HTML.  The HTML code is
surrounded by yaml markup to make Pandoc not fiddle with the HTML.
Set the argument <code>html=FALSE</code> to not add this, in case you are
really rendering markdown.
</p>
<p><code>sepUnitsTrans</code> converts character vectors containing values such
as <code>c("3 days","3day","4month","2 years","2weeks","7")</code> to
numeric vectors 
(here <code>c(3,3,122,730,14,7)</code>) in a flexible fashion.  The user can
specify a 
vector of units of measurements and conversion factors.  The units
with a conversion factor of <code>1</code> are taken as the target units,
and if those units are present in the character strings they are
ignored.  The target units are added to the resulting vector as the
<code>"units"</code> attribute.
</p>
<p><code>strgraphwrap</code> is like <code>strwrap</code> but is for the current
graphics environment.
</p>
<p><code>tobase64image</code> is a function written by Dirk Eddelbuettel that
uses the <code>base64enc</code> package to convert a png graphic file to
base64 encoding to include as an inline image in an html file.
</p>
<p><code>trap.rule</code> computes the area under a curve using the trapezoidal
rule, assuming <code>x</code> is sorted.
</p>
<p><code>trellis.strip.blank</code> sets up Trellis or Lattice graphs to have a
clear background on the strips for panel labels.
</p>
<p><code>unPaste</code> provides a version of the S-Plus <code>unpaste</code> that
works for <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> and S-Plus.
</p>
<p><code>whichClosePW</code> is a very fast function using weighted multinomial
sampling to determine which element of a vector is &quot;closest&quot; to each
element of another vector.  <code>whichClosest</code> quickly finds the closest
element without any randomness.
</p>
<p><code>whichClosek</code> is a slow function that finds, after jittering the
lookup table, the <code>k</code> closest matchest to each element of the
other vector, and chooses from among these one at random.
</p>
<p><code>xless</code> is a function for Linux/Unix users to invoke the system
<code>xless</code> command to pop up a window to display the result of
<code>print</code>ing an object.
</p>


<h3>Usage</h3>

<pre>
confbar(at, est, se, width, q = c(0.7, 0.8, 0.9, 0.95, 0.99), 
        col = gray(c(0, 0.25, 0.5, 0.75, 1)),
        type = c("v", "h"), labels = TRUE, ticks = FALSE,
        cex = 0.5, side = "l", lwd = 5, clip = c(-1e+30, 1e+30),
        fun = function(x) x,
        qfun = function(x) ifelse(x == 0.5, qnorm(x),
                            ifelse(x &lt; 0.5, qnorm(x/2),
                            qnorm((1 +  x)/2))))
getLatestSource(x=NULL, package='Hmisc', recent=NULL, avail=FALSE)
grType()
prType()
htmlSpecialType()
inverseFunction(x, y)
james.stein(y, group)
keepHattrib(obj)
km.quick(S, times, q)
latexBuild(..., insert, sep='')
lm.fit.qr.bare(x, y, tolerance, intercept=TRUE, xpxi=FALSE, singzero=FALSE)
matxv(a, b, kint=1, bmat=FALSE)
nomiss(x)
outerText(string, y, cex=par('cex'), ...)
plotlyParm
plotp(data, ...)
rendHTML(x, html=TRUE)
restoreHattrib(obj, attribs)
sepUnitsTrans(x, conversion=c(day=1, month=365.25/12, year=365.25, week=7),
              round=FALSE, digits=0)
strgraphwrap(x, width = 0.9 * getOption("width"),
             indent = 0, exdent = 0,
             prefix = "", simplify = TRUE, units='user', cex=NULL)
tobase64image(file, Rd = FALSE, alt = "image")
trap.rule(x, y)
trellis.strip.blank()
unPaste(str, sep="/")
whichClosest(x, w)
whichClosePW(x, w, f=0.2)
whichClosek(x, w, k)
xless(x, ..., title)
</pre>


<h3>Arguments</h3>

<table summary="R argblock">
<tr valign="top"><td><code>a</code></td>
<td>
<p>a numeric matrix or vector</p>
</td></tr>
<tr valign="top"><td><code>alt,Rd</code></td>
<td>
<p>see <code>base64::img</code></p>
</td></tr>
<tr valign="top"><td><code>at</code></td>
<td>
<p>x-coordinate for vertical confidence intervals, y-coordinate
for horizontal</p>
</td></tr>
<tr valign="top"><td><code>attribs</code></td>
<td>
<p>an object returned by <code>keepHattrib</code></p>
</td></tr>
<tr valign="top"><td><code>avail</code></td>
<td>
<p>set to <code>TRUE</code> to have <code>getLatestSource</code> return
a data frame of available files and latest versions instead of
fetching any</p>
</td></tr>
<tr valign="top"><td><code>b</code></td>
<td>
<p>a numeric vector</p>
</td></tr>
<tr valign="top"><td><code>cex</code></td>
<td>
<p>character expansion factor</p>
</td></tr>
<tr valign="top"><td><code>clip</code></td>
<td>
<p>interval to truncate limits</p>
</td></tr>
<tr valign="top"><td><code>col</code></td>
<td>
<p>vector of colors</p>
</td></tr>
<tr valign="top"><td><code>conversion</code></td>
<td>
<p>a named numeric vector</p>
</td></tr>
<tr valign="top"><td><code>data</code></td>
<td>
<p>an object having a <code>plotp</code> method</p>
</td></tr>
<tr valign="top"><td><code>digits</code></td>
<td>
<p>number of digits used for <code>round</code></p>
</td></tr>
<tr valign="top"><td><code>est</code></td>
<td>
<p>vector of point estimates for confidence limits</p>
</td></tr>
<tr valign="top"><td><code>f</code></td>
<td>
<p>a scaling constant</p>
</td></tr>
<tr valign="top"><td><code>file</code></td>
<td>
<p>a file name</p>
</td></tr>
<tr valign="top"><td><code>fun</code></td>
<td>
<p>function to transform scale</p>
</td></tr>
<tr valign="top"><td><code>group</code></td>
<td>
<p>a categorical grouping variable</p>
</td></tr>
<tr valign="top"><td><code>html</code></td>
<td>
<p>set to <code>FALSE</code> to tell <code>rendHTML</code> to not
surround HTML code with yaml</p>
</td></tr>
<tr valign="top"><td><code>insert</code></td>
<td>
<p>a list of 3-element lists for <code>latexBuild</code>.
The first of each 3-element
list is a character string with an environment name.  The second
specifies the order: <code>"before"</code> or <code>"after"</code>, the former
indicating that when the environment is found, the third element of
the list is inserted before or after it, according to the second
element.</p>
</td></tr>
<tr valign="top"><td><code>intercept</code></td>
<td>
<p>set to <code>FALSE</code> to not automatically add a column
of ones to the <code>x</code> matrix</p>
</td></tr>
<tr valign="top"><td><code>k</code></td>
<td>
<p>get the <code>k</code> closest matches</p>
</td></tr>
<tr valign="top"><td><code>kint</code></td>
<td>
<p>which element of <code>b</code> to add to the result if <code>a</code>
does not contain a column for intercepts</p>
</td></tr>
<tr valign="top"><td><code>bmat</code></td>
<td>
<p>set to <code>TRUE</code> to consider <code>b</code> a matrix of
repeated coefficients, usually resampled estimates with rows
corresponding to resamples</p>
</td></tr>
<tr valign="top"><td><code>labels</code></td>
<td>
<p>set to <code>FALSE</code> to omit drawing confidence
coefficients</p>
</td></tr>
<tr valign="top"><td><code>lwd</code></td>
<td>
<p>line widths</p>
</td></tr>
<tr valign="top"><td><code>package</code></td>
<td>
<p>name of package for <code>getLatestSource</code>, default is
<code>'Hmisc'</code></p>
</td></tr>
<tr valign="top"><td><code>obj</code></td>
<td>
<p>a variable, data frame, or data table</p>
</td></tr>
<tr valign="top"><td><code>q</code></td>
<td>
<p>vector of confidence coefficients or quantiles</p>
</td></tr>
<tr valign="top"><td><code>qfun</code></td>
<td>
<p>quantiles on transformed scale</p>
</td></tr>
<tr valign="top"><td><code>recent</code></td>
<td>
<p>an integer telling <code>getLatestSource</code> to get the
<code>recent</code> most recently modified files from the package</p>
</td></tr>
<tr valign="top"><td><code>round</code></td>
<td>
<p>set to <code>TRUE</code> to round converted values</p>
</td></tr>
<tr valign="top"><td><code>S</code></td>
<td>
<p>a <code><a href="../../survival/help/Surv.html">Surv</a></code> object</p>
</td></tr>
<tr valign="top"><td><code>se</code></td>
<td>
<p>vector of standard errors</p>
</td></tr>
<tr valign="top"><td><code>sep</code></td>
<td>
<p>a single character string specifying the delimiter.  For
<code>latexBuild</code> the default is <code>""</code>.</p>
</td></tr>
<tr valign="top"><td><code>side</code></td>
<td>
<p>for <code>confbar</code> is <code>"b","l","t","r"</code> for bottom,
left, top, right.</p>
</td></tr>
<tr valign="top"><td><code>str</code></td>
<td>
<p>a character string vector</p>
</td></tr>
<tr valign="top"><td><code>string</code></td>
<td>
<p>a character string vector</p>
</td></tr>
<tr valign="top"><td><code>ticks</code></td>
<td>
<p>set to <code>TRUE</code> to draw lines between rectangles</p>
</td></tr>
<tr valign="top"><td><code>times</code></td>
<td>
<p>a numeric vector of times</p>
</td></tr>
<tr valign="top"><td><code>title</code></td>
<td>
<p>a character string to title a window or plot</p>
</td></tr>
<tr valign="top"><td><code>tolerance</code></td>
<td>
<p>tolerance for judging singularity in matrix</p>
</td></tr>
<tr valign="top"><td><code>type</code></td>
<td>
<p><code>"v"</code> for vertical, <code>"h"</code> for horizontal.</p>
</td></tr>
<tr valign="top"><td><code>w</code></td>
<td>
<p>a numeric vector</p>
</td></tr>
<tr valign="top"><td><code>width</code></td>
<td>
<p>width of confidence rectanges in user units, or see
<code><a href="../../base/html/strwrap.html">strwrap</a></code></p>
</td></tr> 
<tr valign="top"><td><code>x</code></td>
<td>
<p>a numeric vector (matrix for <code>lm.fit.qr.bare</code>) or data
frame.  For <code>xless</code> may be any object that is sensible to
<code>print</code>.  For <code>sepUnitsTrans</code> is a character or factor
variable.  For <code>getLatestSource</code> is a character string or
vector of character strings containing base file names to retrieve
from CVS.  Set <code>x='all'</code> to retrieve all source files.  For
<code>clowess</code>, <code>x</code> may also be a list with x and y
components.  For <code>inverseFunction</code>, <code>x</code> and <code>y</code>
contain evaluations of the function whose inverse is needed.
<code>x</code> is typically an equally-spaced grid of 1000 points.  For
<code>strgraphwrap</code> is a character vector.  For <code>rendHTML</code>
<code>x</code> is a character vector.</p>
</td></tr>
<tr valign="top"><td><code>xpxi</code></td>
<td>
<p>set to <code>TRUE</code> to add an element to the result
containing the inverse of <i>X'X</i></p>
</td></tr>
<tr valign="top"><td><code>singzero</code></td>
<td>
<p>set to <code>TRUE</code> to set coefficients corresponding
to singular variables to zero instead of <code>NA</code>.</p>
</td></tr>
<tr valign="top"><td><code>y</code></td>
<td>
<p>a numeric vector.  For <code>inverseFunction</code> <code>y</code> is the
evaluated function values at <code>x</code>.</p>
</td></tr>
<tr valign="top"><td><code>indent, exdent, prefix</code></td>
<td>
<p>see <code><a href="../../base/html/strwrap.html">strwrap</a></code></p>
</td></tr>
<tr valign="top"><td><code>simplify</code></td>
<td>
<p>see <code><a href="../../base/html/lapply.html">sapply</a></code></p>
</td></tr>
<tr valign="top"><td><code>units</code></td>
<td>
<p>see <code><a href="../../graphics/html/par.html">par</a></code></p>
</td></tr>
<tr valign="top"><td><code>...</code></td>
<td>
<p>arguments passed through to another function.  For
<code>latexBuild</code> represents pairs, with odd numbered elements being
character strings containing LaTeX code or a zero-length object to
ignore, and even-numbered elements representing LaTeX left
parenthesis, left brace, or left bracket, or environment name.</p>
</td></tr>
</table>


<h3>Author(s)</h3>

<p>Frank Harrell and Charles Dupont</p>


<h3>Examples</h3>

<pre>


trap.rule(1:100,1:100)

unPaste(c('a;b or c','ab;d','qr;s'), ';')

sepUnitsTrans(c('3 days','4 months','2 years','7'))

set.seed(1)
whichClosest(1:100, 3:5)
whichClosest(1:100, rep(3,20))

whichClosePW(1:100, rep(3,20))
whichClosePW(1:100, rep(3,20), f=.05)
whichClosePW(1:100, rep(3,20), f=1e-10)

x &lt;- seq(-1, 1, by=.01)
y &lt;- x^2
h &lt;- inverseFunction(x,y)
formals(h)$turns   # vertex
a &lt;- seq(0, 1, by=.01)
plot(0, 0, type='n', xlim=c(-.5,1.5))
lines(a, h(a)[,1])            ## first inverse
lines(a, h(a)[,2], col='red') ## second inverse
a &lt;- c(-.1, 1.01, 1.1, 1.2)
points(a, h(a)[,1])

d &lt;- data.frame(x=1:2, y=3:4, z=5:6)
d &lt;- upData(d, labels=c(x='X', z='Z lab'), units=c(z='mm'))
a &lt;- keepHattrib(d)

d &lt;- data.frame(x=1:2, y=3:4, z=5:6)
d2 &lt;- restoreHattrib(d, a)
sapply(d2, attributes)

## Not run: 
getLatestSource(recent=5)  # source() most recent 5 revised files in Hmisc
getLatestSource('cut2')    # fetch and source latest cut2.s
getLatestSource('all')     # get everything
getLatestSource(avail=TRUE) # list available files and latest versions

## End(Not run)
</pre>

<hr /><div style="text-align: center;">[Package <em>Hmisc</em> version 4.8-0 <a href="00Index.html">Index</a>]</div>
</div></body></html>
